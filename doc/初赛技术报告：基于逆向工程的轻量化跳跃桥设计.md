# åˆèµ›æŠ€æœ¯æŠ¥å‘Šï¼šåŸºäºé€†å‘å·¥ç¨‹çš„è½»é‡åŒ–è·³è·ƒæ¡¥è®¾è®¡

### æŠ¥å‘Šæ¦‚è§ˆ
- **å‚èµ›é˜Ÿä¼**ï¼š**ç‚®ç°è€äººç»„**
- **æäº¤æ—¥æœŸ**ï¼š2025å¹´11æœˆ23æ—¥
- **èµ›é¢˜æ–¹å‘**ï¼šæ¡¥æ¢ç»“æ„ä¼˜åŒ–ä¸è‡ªåŠ¨åŒ–æ„å»º
- **æ ¸å¿ƒäº®ç‚¹**ï¼šå¯è§†åŒ–é€†å‘å·¥å…·é“¾ã€31æ ¹æç®€æ†ä»¶ã€è·³è·ƒå¼ç»“æ„

---

### ä¸€ã€ èµ›é¢˜åˆ†æä¸è®¾è®¡ç­–ç•¥

#### 1.1 åœºæ™¯åˆ†æ
æœ¬æ¬¡èµ›é¢˜åœºæ™¯å…·æœ‰æ˜¾è‘—çš„åœ°å½¢é«˜å·®ç‰¹å¾ï¼š
- **èµ·ç‚¹åŒºåŸŸ**ï¼šä½äºå·¦ä¾§é«˜ç©ºï¼ˆY=17~23åŒºé—´ï¼‰ï¼Œéœ€è¦æ„å»ºåŠ é€Ÿå¹³å°ã€‚
- **ç»ˆç‚¹åŒºåŸŸ**ï¼šä½äºå³ä¾§ä½åœ°ï¼ˆY=3~6åŒºé—´ï¼‰ï¼Œéœ€è¦æ„å»ºæ‰¿æ¥é«˜é€Ÿå†²å‡»çš„ç€é™†å¡é“ã€‚
- **ä¸­é—´åŒºåŸŸ**ï¼šå­˜åœ¨å·¨å¤§è·¨åº¦ï¼Œä¸”æ— ä¸­é—´æ”¯æ’‘ç‚¹ã€‚

#### 1.2 æ ¸å¿ƒç­–ç•¥ï¼šä»¥â€œè·³â€ä»£â€œè¿â€
ä¸ºäº†æœ€å¤§åŒ–åˆ†æ•°ï¼ˆå³æœ€å°åŒ–æˆæœ¬ï¼‰ï¼Œæˆ‘ä»¬æ‘’å¼ƒäº†æ˜‚è´µçš„â€œé«˜ç©ºé•¿æ¡¥â€æ–¹æ¡ˆï¼Œè½¬è€Œåˆ©ç”¨åœ°å½¢é«˜å·®ï¼Œé‡‡ç”¨**é‡åŠ›åŠ¿èƒ½é©±åŠ¨**çš„æ–­è·ƒè®¾è®¡ï¼š
1. **èµ·è·³å¼•å¯¼ï¼ˆå·¦ä¾§ï¼‰**ï¼š ä»…æ„å»ºæçŸ­çš„è·¯é¢å»¶ä¼¸æ®µï¼Œä¸å†å¯»æ±‚æ°´å¹³è¿æ¥ï¼Œè€Œæ˜¯åˆ©ç”¨å·¦ä¾§é«˜å°çš„**é‡åŠ›åŠ¿èƒ½**ï¼Œå¼•å¯¼è½¦è¾†ä»¥é¢„å®šçš„æŠ›ç‰©çº¿è½¨è¿¹é©¶å‡ºï¼Œè¿›å…¥è‡ªç”±è½ä½“çŠ¶æ€ã€‚
2. **ç©ºä¸­é£è·ƒï¼ˆä¸­é—´åŒºåŸŸï¼‰**ï¼š **ä¸»åŠ¨æ”¾å¼ƒä¸­é—´è·¨åº¦è¿æ¥**ã€‚åˆ©ç”¨è½¦è¾†ä¸‹å äº§ç”Ÿçš„åŠ¨èƒ½è·¨è¶Šä¸­é—´çš„æ— æ•ˆåœ°å½¢åŒºåŸŸï¼Œé€šè¿‡â€œç•™ç™½â€è®¾è®¡èŠ‚çœäº†çº¦ 40% çš„æ¨ªå‘æ”¯æ’‘ææ–™æˆæœ¬ã€‚
3. **æŸ”æ€§æ‰¿æ¥ä¸åå†²ï¼ˆå³ä¾§ï¼‰**ï¼š åœ¨åº•éƒ¨æ„å»º**â€œå‹ºå‹â€ç¼“å†²å¡é“**ï¼ˆè§ä»¿çœŸå›¾é»„è‰²è·¯é¢æ®µï¼‰ã€‚è¯¥ç»“æ„é€šè¿‡å¯†é›†çš„ä¸‰è§’å½¢æœ¨æ”¯æ’‘ï¼ˆWoodï¼‰æä¾›å¼¹æ€§ï¼Œä¸ä»…èƒ½æŸ”æ€§å¸æ”¶è½¦è¾†å è½æ—¶çš„å·¨å¤§å†²å‡»åŠ›ï¼Œè¿˜èƒ½åˆ©ç”¨å¼§å½¢è·¯é¢å°†å‚ç›´ä¸‹å çš„åŠ¨èƒ½è½¬åŒ–ä¸ºæ°´å¹³å‘å‰çš„åŠ¨èƒ½ï¼ŒåŠ©æ¨è½¦è¾†å†²ä¸Šå³ä¾§ç»ˆç‚¹é«˜å°ã€‚

---

### äºŒã€ å·¥ç¨‹åŒ–åˆ›æ–°ï¼šå¯è§†åŒ–é€†å‘å·¥ä½œæµ

ä¸ºäº†è§£å†³â€œä»£ç æ‰‹å†™åæ ‡æ•ˆç‡ä½ã€æ˜“å‡ºé”™â€çš„ç—›ç‚¹ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€å¥—è‡ªç ”å·¥å…·é“¾ï¼Œå®ç°äº†â€œæ‰€è§å³æ‰€å¾—â€çš„é«˜æ•ˆå¼€å‘æ¨¡å¼ã€‚

#### 2.1 å·¥ä½œæµæ¶æ„
```mermaid
graph LR
    A[æ¸¸æˆå†…å¯è§†åŒ–ç¼–è¾‘å™¨] -->|ä¿å­˜ä¸º .level| B(files/jump.level)
    C[ç©ºåœ°å›¾åŸºå‡†] -->|ä¿å­˜ä¸º .level| D(files/dian.level)
    B & D --> E[è‡ªç ”è„šæœ¬: Transfer.py]
    E -->|å·®åˆ†ç®—æ³•| F[è‡ªåŠ¨ç”Ÿæˆ frame/model.py]
    F --> G[æ¨¡æ‹Ÿå™¨éªŒè¯]
```

#### 2.2 æ ¸å¿ƒå·¥å…·ï¼š`Transfer.py`
æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œé€šè¿‡å¯¹æ¯”â€œåŒ…å«æ¡¥æ¢çš„å­˜æ¡£â€ä¸â€œç©ºåœ°å›¾å­˜æ¡£â€ï¼Œåˆ©ç”¨é›†åˆå·®åˆ†ç®—æ³•è‡ªåŠ¨æå–ç”¨æˆ·æ„å»ºçš„ç»“æ„ã€‚

**è„šæœ¬æŠ€æœ¯ç»†èŠ‚ï¼š**
- **åæ ‡æ ‡å‡†åŒ–**ï¼šå°†æ¸¸æˆåæ ‡é™¤ä»¥ 40 å¹¶å–æ•´ï¼Œè½¬æ¢ä¸º Grid åæ ‡ã€‚
- **å»é‡ç®—æ³•**ï¼šåˆ©ç”¨ `(p0, p1, material)` å…ƒç»„ä½œä¸ºå“ˆå¸Œé”®ï¼Œç²¾å‡†å‰”é™¤åœ°å›¾è‡ªå¸¦çš„å›ºå®šç‚¹ï¼Œåªä¿ç•™ç©å®¶æ­å»ºçš„æ¡¥æ¢ã€‚
- **è‡ªåŠ¨ä»£ç ç”Ÿæˆ**ï¼šç›´æ¥è¾“å‡ºç¬¦åˆèµ›é¢˜è§„èŒƒçš„ `model.py` æ ¼å¼ã€‚

---

### ä¸‰ã€ ç»“æ„è®¾è®¡è¯¦è§£ (v4.0 Final)

åŸºäºä¸Šè¿°å·¥ä½œæµï¼Œæˆ‘ä»¬æœ€ç»ˆè®¾è®¡äº†æä¸ºç²¾ç®€çš„ v4.0 ç‰ˆæœ¬ã€‚

#### 3.1 ç»“æ„ç»Ÿè®¡
| æŒ‡æ ‡         | æ•°å€¼      | è¯„ä»·               |
| :----------- | :-------- | :----------------- |
| **æ€»æ†ä»¶æ•°** | **31 æ ¹** | **æä½æˆæœ¬**       |
| Road ææ–™    | 9 æ ¹      | ä»…ç”¨äºå¿…è¦çš„è·¯é¢   |
| Wood ææ–™    | 22 æ ¹     | æä¾›é«˜æ€§ä»·æ¯”æ”¯æ’‘   |
| ç»“æ„å½¢æ€     | åŒå²›å¼    | å·¦é«˜å³ä½ï¼Œä¸­é—´æ–­å¼€ |

#### 3.2 å…³é”®éƒ¨ä½åŠ›å­¦åˆ†æ

**A. å·¦ä¾§èµ·è·³å°ï¼ˆæ†ä»¶ 0-12ï¼‰**

- **è·¯é¢è®¾è®¡**ï¼š`[-31, 17]` åˆ° `[-2, 19]` çš„å¹³ç¼“è·¯é¢ï¼Œç¡®ä¿è½¦è¾†å‡ºå°„è§’åº¦æ°´å¹³ã€‚
- **æ”¯æ’‘ç»“æ„**ï¼šé‡‡ç”¨â€œWâ€å‹ä¸‹æ¡æ¶ç»“æ„ï¼ˆèŠ‚ç‚¹ `[-21, 16]`, `[-14, 16]`ï¼‰ï¼Œå°†è·¯é¢å‹åŠ›å‡åŒ€ä¼ é€’è‡³å·¦ä¾§æ‚¬å´–å£ã€‚
- **é”šç‚¹åˆ©ç”¨**ï¼šå……åˆ†åˆ©ç”¨äº† `[-33, 13]` å’Œ `[-28, 23]` ç­‰é«˜ä½é”šç‚¹è¿›è¡Œæ‚¬æŒ‚å’Œæ”¯æ’‘ã€‚

**B. å³ä¾§ç€é™†å¡ï¼ˆæ†ä»¶ 13-30ï¼‰**
- **æ¥åœ°ç‚¹**ï¼šè½¦è¾†é¢„è®¡è½åœ¨ `[6, 19]` è‡³ `[10, 16]` åŒºåŸŸã€‚æ­¤å¤„è·¯é¢é‡‡ç”¨ Road ææ–™å¼ºåŒ–ã€‚
- **é•¿ç¼“å¡**ï¼šä» Y=19 ä¸€è·¯å»¶ä¼¸è‡³ Y=3ï¼ˆç»ˆç‚¹ï¼‰ï¼Œå½¢æˆä¸€ä¸ªå·¨å¤§çš„ç›´è§’ä¸‰è§’å½¢ç»“æ„ã€‚
- **å¯†é›†ä¸‰è§’ç½‘**ï¼šåœ¨å³ä¾§ç»“æ„è…¹éƒ¨ï¼ˆ`[21, 13]`, `[28, 11]` åŒºåŸŸï¼‰æ„å»ºäº†é«˜å¯†åº¦çš„æœ¨è´¨ä¸‰è§’ç½‘æ ¼ã€‚è¿™ä¸ä»…æ”¯æ’‘äº†ä¸Šæ–¹è·¯é¢ï¼Œè¿˜é€šè¿‡å¤šä¸ªé”šç‚¹ï¼ˆ`[27, 17]`, `[32, 23]`ï¼‰æœ‰æ•ˆæŠµæŠ—äº†è½¦è¾†è½åœ°æ—¶çš„å·¨å¤§å‰ªåˆ‡åŠ›ã€‚

---

### å››ã€ æœ€ç»ˆæäº¤ä»£ç ä¸ä»¿çœŸæ•ˆæœç¤ºä¾‹

#### 4.1 æ¡¥æ¢æ¨¡å‹ (`frame/model.py`)

```python
"""
è‡ªåŠ¨ç”Ÿæˆçš„ model.py, æ¥æºäº jump.level ç‹¬æœ‰ stick
Team: ç‚®ç°è€äººç»„
"""

def model() -> dict:
    sticks = [
        # ========== å·¦ä¾§èµ·è·³å¹³å° ==========
        # é”šç‚¹è¿æ¥ä¸æ”¯æ’‘
        {'p0': [-31, 17], 'p1': [-28, 23], 'material': 'wood' },
        {'p0': [-31, 17], 'p1': [-33, 13], 'material': 'wood' },
        {'p0': [-3, 23], 'p1': [-9, 19], 'material': 'wood' },
        
        # åŠ é€Ÿè·¯é¢
        {'p0': [-9, 19], 'p1': [-2, 19], 'material': 'road' },
        {'p0': [-17, 19], 'p1': [-9, 19], 'material': 'road' },
        {'p0': [-17, 19], 'p1': [-25, 19], 'material': 'road' },
        {'p0': [-25, 19], 'p1': [-31, 17], 'material': 'road' },
        
        # å·¦ä¾§ä¸‹éƒ¨æ¡æ¶
        {'p0': [-28, 23], 'p1': [-25, 19], 'material': 'wood' },
        {'p0': [-25, 19], 'p1': [-21, 16], 'material': 'wood' },
        {'p0': [-21, 16], 'p1': [-17, 19], 'material': 'wood' },
        {'p0': [-17, 19], 'p1': [-14, 16], 'material': 'wood' },
        {'p0': [-14, 16], 'p1': [-9, 19], 'material': 'wood' },
        {'p0': [-14, 16], 'p1': [-21, 16], 'material': 'wood' },

        # ========== å³ä¾§ç€é™†ç¼“å¡ ==========
        # ä¸»è·¯é¢ (Road)
        {'p0': [6, 19], 'p1': [10, 16], 'material': 'road' },
        {'p0': [10, 16], 'p1': [16, 12], 'material': 'road' },
        {'p0': [16, 12], 'p1': [23, 9], 'material': 'road' },
        {'p0': [23, 9], 'p1': [30, 6], 'material': 'road' },
        {'p0': [30, 6], 'p1': [37, 3], 'material': 'road' },
        
        # ç»ˆç‚¹åŠ å›º
        {'p0': [30, 6], 'p1': [34, 9], 'material': 'wood' },
        {'p0': [34, 9], 'p1': [37, 3], 'material': 'wood' },
        {'p0': [34, 9], 'p1': [37, 13], 'material': 'wood' },
        
        # é¡¶éƒ¨æ‹‰ç´¢/æ”¯æ’‘
        {'p0': [10, 16], 'p1': [7, 23], 'material': 'wood' },
        
        # è…¹éƒ¨ä¸‰è§’æ”¯æ’‘ç½‘ (æ ¸å¿ƒæ‰¿é‡åŒº)
        {'p0': [30, 6], 'p1': [28, 11], 'material': 'wood' },
        {'p0': [28, 11], 'p1': [23, 9], 'material': 'wood' },
        {'p0': [28, 11], 'p1': [34, 9], 'material': 'wood' },
        {'p0': [16, 12], 'p1': [21, 13], 'material': 'wood' },
        {'p0': [21, 13], 'p1': [23, 9], 'material': 'wood' },
        {'p0': [21, 13], 'p1': [28, 11], 'material': 'wood' },
        {'p0': [21, 13], 'p1': [27, 17], 'material': 'wood' },
        {'p0': [28, 11], 'p1': [27, 17], 'material': 'wood' },
        {'p0': [27, 17], 'p1': [32, 23], 'material': 'wood' },
    ]

    return {'sticks': sticks}
```

#### 4.2 å·¥å…·è„šæœ¬ (`Transfer.py`)

```python
"""
å°† .level æ–‡ä»¶ä¸­çš„ sticks ä¿¡æ¯è½¬æ¢ä¸º model.py æ ¼å¼
ç”¨æ³•ï¼špython level2model.py files/jump2.level files/dian.level frame/model.py
"""
import sys
import json

def get_sticks(level_path):
    # è¯»å– level æ–‡ä»¶å¹¶è§£æä¸ºåæ ‡ç‚¹
    with open(level_path, 'r', encoding='utf-8') as f:
        level = json.load(f)
    points = level.get('points', [])
    # åæ ‡ç½‘æ ¼åŒ–å¤„ç†
    id2xy = {p['id']: [int(round(p['x']/40)), int(round(p['y']/40))] for p in points if 'id' in p}
    sticks = []
    for s in level.get('sticks', []):
        if not s.get('prefab', False): continue
        p0 = id2xy.get(s.get('point0_id'))
        p1 = id2xy.get(s.get('point1_id'))
        if p0 and p1:
            sticks.append({'p0': p0, 'p1': p1, 'material': s.get('material', 'road')})
    return sticks

def level_diff_sticks(jump_path, dian_path, model_path):
    # å·®åˆ†å¯¹æ¯”ï¼Œæå–æ–°å¢æ†ä»¶
    jump_sticks = get_sticks(jump_path)
    dian_sticks = get_sticks(dian_path)
    
    def stick_key(s): return (tuple(s['p0']), tuple(s['p1']), s['material'])
    dian_keys = set(stick_key(s) for s in dian_sticks)
    
    unique_sticks = [s for s in jump_sticks if stick_key(s) not in dian_keys]
    
    # æ ¼å¼åŒ–è¾“å‡º
    header = '"""\nè‡ªåŠ¨ç”Ÿæˆçš„ model.py, æ¥æºäº jump.level ç‹¬æœ‰ stick\n"""\n\ndef model() -> dict:\n    sticks = [\n'
    for s in unique_sticks:
        header += f"        {{'p0': {s['p0']}, 'p1': {s['p1']}, 'material': '{s['material']}' }},\n"
    header += "    ]\n\n    return {'sticks': sticks}\n"
    
    with open(model_path, 'w', encoding='utf-8') as f:
        f.write(header)
    print(f'âœ… è½¬æ¢æˆåŠŸï¼šå·²å°†ç‹¬æœ‰æ¡¥æ¢ä¿¡æ¯å†™å…¥ {model_path}')

if __name__ == '__main__':
    if len(sys.argv) < 4:
        print('ç”¨æ³•: python level2model.py <å«æ¡¥å­˜æ¡£> <ç©ºå­˜æ¡£> <è¾“å‡ºè·¯å¾„>')
    else:
        level_diff_sticks(sys.argv[1], sys.argv[2], sys.argv[3])
```

#### 4.3 ä»¿çœŸæ•ˆæœç¤ºä¾‹

![image-20251123224649339](C:\Users\14437\AppData\Roaming\Typora\typora-user-images\image-20251123224649339.png)

---

### äº”ã€ ç®—æ³•æ¢ç´¢ï¼šåŸºäºé—ä¼ ç®—æ³•çš„è‡ªåŠ¨åŒ–å¯»ä¼˜å°è¯•

é™¤äº†æ‰‹åŠ¨è®¾è®¡ä¸é€†å‘å·¥ç¨‹ï¼Œæˆ‘ä»¬è¿˜å°è¯•å¼•å…¥**é—ä¼ ç®—æ³•ï¼ˆGenetic Algorithmï¼‰**æ¥æ¢ç´¢è®¾è®¡çš„æå€¼ï¼Œè¯•å›¾åœ¨æ‰‹åŠ¨æ–¹æ¡ˆçš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥é™ä½æˆæœ¬ã€‚

#### 5.1 ç®—æ³•è®¾è®¡ (`genetic_runner.py`)

æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªåŸºäºå¾®è¿›åŒ–ç­–ç•¥çš„ä¼˜åŒ–å™¨ï¼Œä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š

- **ç§å­åˆå§‹åŒ– (Seed-based)**ï¼šç›´æ¥åŠ è½½æˆ‘ä»¬æ‰‹åŠ¨è®¾è®¡çš„æœ€ä¼˜è§£ï¼ˆ31æ ¹æ†ä»¶ï¼‰ä½œä¸ºåˆå§‹ç§ç¾¤çš„â€œå¤å¨ƒâ€ï¼Œé¿å…ä»é›¶éšæœºæœç´¢çš„ä½æ•ˆã€‚
- **å¾®ç§ç¾¤ (Micro-GA)**ï¼šè€ƒè™‘åˆ°ç‰©ç†æ¨¡æ‹Ÿçš„é«˜è€—æ—¶ï¼Œæˆ‘ä»¬å°†ç§ç¾¤å¤§å°é™åˆ¶åœ¨ 6-10 ä¸ªï¼Œä¸“æ³¨äºå±€éƒ¨æœç´¢ã€‚
- **æ— å¤´æ¨¡å¼è¯„ä¼°**ï¼šé€šè¿‡ Python `subprocess` æ¨¡å—ç›´æ¥è°ƒç”¨ `main_auto.py`ï¼Œå¹¶è§£ææ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰è·å–åˆ†æ•°ï¼Œå®ç°è‡ªåŠ¨åŒ–é—­ç¯ã€‚

#### 5.2 å˜å¼‚ç®—å­è®¾è®¡

ä¸ºäº†åœ¨æå°çš„æœç´¢ç©ºé—´å†…å¯»æ‰¾çªç ´ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ç§é’ˆå¯¹æ€§çš„å˜å¼‚ç­–ç•¥ï¼š

1. **åæ ‡å¾®æ‰° (70%)**ï¼šå¯¹æ†ä»¶ç«¯ç‚¹è¿›è¡Œ Â±2 Grid çš„éšæœºæŠ–åŠ¨ï¼Œå¯»æ‰¾åº”åŠ›æ›´ä¼˜çš„å‡ ä½•æ„å‹ã€‚
2. **ææ–™é™çº§ (20%)**ï¼šå°è¯•å°†æ˜‚è´µçš„ Road æ›¿æ¢ä¸ºå»‰ä»·çš„ Woodã€‚
3. **æé™å‡é‡ (10%)**ï¼šéšæœºåˆ é™¤éå…³é”®æ†ä»¶ï¼Œæµ‹è¯•ç»“æ„çš„æé™ç¨³å®šæ€§ã€‚

#### 5.3 å®éªŒç»“è®º

è™½ç„¶é—ä¼ ç®—æ³•æˆåŠŸè¿è¡Œå¹¶äº§ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„å˜ä½“ï¼Œä½†åœ¨æœ¬æ¬¡åˆèµ›ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†**é€†å‘å·¥ç¨‹çš„æ‰‹åŠ¨æ–¹æ¡ˆ**ä½œä¸ºæœ€ç»ˆæäº¤ï¼ŒåŸå› å¦‚ä¸‹ï¼š

- **è¯„ä¼°æˆæœ¬è¿‡é«˜**ï¼šæ¯æ¬¡ç‰©ç†æ¨¡æ‹Ÿéœ€è€—æ—¶ 30 ç§’ï¼Œç®—æ³•æ”¶æ•›éœ€è¦æ•°å°æ—¶ï¼Œæ—¶é—´æˆæœ¬è¾ƒé«˜ã€‚
- **ç‰©ç†å¼•æ“çš„ç¡®å®šæ€§**ï¼šåœ¨æä½æ†ä»¶æ•°ä¸‹ï¼Œå¾®å°çš„åæ ‡å˜åŠ¨å®¹æ˜“å¯¼è‡´ç»“æ„åœ¨ 29 ç§’æ—¶çªç„¶åå¡Œï¼Œç®—æ³•éš¾ä»¥æ•æ‰è¿™ç§éçº¿æ€§çš„ç‰©ç†è¾¹ç•Œã€‚

å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸€å°è¯•éªŒè¯äº†**â€œAIè¾…åŠ©è®¾è®¡â€**åœ¨æ¡¥æ¢ç»“æ„ä¼˜åŒ–ä¸­çš„å¯è¡Œæ€§ï¼Œä¸ºå¤èµ›æ›´å¤æ‚çš„åœºæ™¯ç§¯ç´¯äº†æŠ€æœ¯å‚¨å¤‡ã€‚

#### 5.4 ç®—æ³•ä»£ç 

```python
# -*- coding: utf-8 -*-
"""
SeedCup2025 é—ä¼ ç®—æ³•è‡ªåŠ¨ä¼˜åŒ–æ¨¡å— (Micro-GAç‰ˆ)
åŠŸèƒ½ï¼šåŸºäºç°æœ‰ model.py è¿›è¡Œå¾®è°ƒä¼˜åŒ–ï¼Œå¯»æ‰¾æ›´é«˜åˆ†
Team: ç‚®ç°è€äººç»„
"""

import sys
import os
import json
import random
import copy
import subprocess
import time
import shutil
import re
from datetime import datetime

# ================= é…ç½®åŒº =================
POPULATION_SIZE = 6       # æå°ç§ç¾¤ï¼Œé€‚åº”30ç§’é•¿çš„è¯„ä¼°æ—¶é—´
GENERATIONS = 20          # è¿­ä»£ä»£æ•°
MUTATION_RATE = 0.3       # é«˜å˜å¼‚ç‡ï¼Œé˜²æ­¢é™·å…¥å±€éƒ¨æœ€ä¼˜
SIGMA = 2.0               # åæ ‡æ‰°åŠ¨èŒƒå›´ï¼ˆå•ä½ï¼šGridï¼‰

# æ–‡ä»¶è·¯å¾„
MODEL_FILE = os.path.join('frame', 'model.py')
BACKUP_FILE = os.path.join('frame', 'model.py.bak')
BEST_SAVE_DIR = 'ga_results'

# ================= æ ¸å¿ƒç±»å®šä¹‰ =================

class Bridge:
    def __init__(self, sticks=None):
        self.sticks = copy.deepcopy(sticks) if sticks else []
        self.fitness = -float('inf')
        self.cost = 0

    def to_model_content(self):
        """ç”Ÿæˆ model.py çš„æ–‡æœ¬å†…å®¹"""
        content = '"""\nè‡ªåŠ¨ç”Ÿæˆçš„ model.py - GAä¼˜åŒ–ç‰ˆ\nTeam: ç‚®ç°è€äººç»„\n"""\n\n'
        content += 'def model() -> dict:\n'
        content += '    sticks = [\n'
        for s in self.sticks:
            content += f"        {{'p0': {s['p0']}, 'p1': {s['p1']}, 'material': '{s['material']}' }},\n"
        content += '    ]\n\n'
        content += "    return {'sticks': sticks}\n"
        return content

    def save_to_file(self, filepath):
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(self.to_model_content())

# ================= é—ä¼ æ“ä½œç®—å­ =================

def mutate(bridge):
    """å˜å¼‚ï¼šå¾®è°ƒåæ ‡ã€æ”¹å˜ææ–™ã€åˆ é™¤æ†ä»¶"""
    new_bridge = Bridge(bridge.sticks)
    
    if not new_bridge.sticks:
        return new_bridge

    # ç­–ç•¥1ï¼šåæ ‡å¾®æ‰° (70%æ¦‚ç‡)
    if random.random() < 0.7:
        idx = random.randint(0, len(new_bridge.sticks) - 1)
        stick = new_bridge.sticks[idx]
        point = random.choice(['p0', 'p1'])
        axis = random.choice([0, 1])
        
        # æ–½åŠ æ‰°åŠ¨
        change = random.choice([-1, 1]) * random.randint(1, int(SIGMA))
        original_val = stick[point][axis]
        stick[point][axis] += change
        
        # ç®€å•è¾¹ç•Œæ£€æŸ¥ (é˜²æ­¢é£å‡ºåœ°å›¾å¤ªè¿œ)
        if abs(stick[point][axis]) > 50: 
            stick[point][axis] = original_val

    # ç­–ç•¥2ï¼šå°è¯•å°† road é™çº§ä¸º wood (20%æ¦‚ç‡ï¼Œçœé’±)
    elif random.random() < 0.9:
        roads = [i for i, s in enumerate(new_bridge.sticks) if s['material'] == 'road']
        if roads:
            idx = random.choice(roads)
            new_bridge.sticks[idx]['material'] = 'wood'
            
    # ç­–ç•¥3ï¼šåˆ é™¤ä¸€æ ¹æ†ä»¶ (10%æ¦‚ç‡ï¼Œæé™å‡é‡)
    else:
        if len(new_bridge.sticks) > 3:
            idx = random.randint(0, len(new_bridge.sticks) - 1)
            new_bridge.sticks.pop(idx)
            
    return new_bridge

def crossover(p1, p2):
    """äº¤å‰ï¼šäº¤æ¢éƒ¨åˆ†ç»“æ„"""
    if random.random() > 0.5 or len(p1.sticks) < 2 or len(p2.sticks) < 2:
        return Bridge(p1.sticks), Bridge(p2.sticks)
    
    # ç®€å•å•ç‚¹äº¤å‰
    cut1 = random.randint(1, len(p1.sticks)-1)
    cut2 = random.randint(1, len(p2.sticks)-1)
    
    # åªè¦ä¿è¯é€»è¾‘é€šé¡ºå³å¯ï¼Œä¸å¿…ä¸¥æ ¼å¯¹é½
    c1_sticks = p1.sticks[:cut1] + p2.sticks[cut2:]
    c2_sticks = p2.sticks[:cut2] + p1.sticks[cut1:]
    
    return Bridge(c1_sticks), Bridge(c2_sticks)

# ================= è¯„ä¼°å¼•æ“ =================

def evaluate(bridge, gen, idx):
    """è°ƒç”¨ main_auto.py è¿›è¡ŒçœŸæœºè¯„ä¼°"""
    # 1. å†™å…¥æ¨¡å‹æ–‡ä»¶
    bridge.save_to_file(MODEL_FILE)
    
    print(f"    > ä¸ªä½“ {idx+1}: ", end='', flush=True)
    
    try:
        # 2. è¿è¡Œæ¨¡æ‹Ÿå™¨ (30s è¶…æ—¶)
        # æ³¨æ„ï¼šmain_auto.py ä¼šè‡ªåŠ¨è¿è¡Œ 30s
        start_time = time.time()
        result = subprocess.run(
            [sys.executable, "main_auto.py"],
            capture_output=True,
            text=True,
            encoding='utf-8',
            errors='ignore',
            timeout=40 # ç»™ä¸€ç‚¹ç¼“å†²æ—¶é—´
        )
        duration = time.time() - start_time
        
        # 3. è§£æè¾“å‡ºæ‰¾åˆ†æ•°
        # å¸¸è§è¾“å‡ºæ ¼å¼ï¼š "Total Score: 12345" æˆ– "å¾—åˆ†ï¼š12345"
        score = -float('inf')
        output_log = result.stdout + result.stderr
        
        # æ­£åˆ™åŒ¹é…åˆ†æ•°
        patterns = [
            r'Score[\D]*(-?\d+\.?\d*)',
            r'å¾—åˆ†[\D]*(-?\d+\.?\d*)',
            r'Total[\D]*(-?\d+\.?\d*)'
        ]
        
        for pat in patterns:
            matches = re.findall(pat, output_log, re.IGNORECASE)
            if matches:
                # å–æœ€åä¸€ä¸ªåŒ¹é…åˆ°çš„æ•°å­—ï¼Œé€šå¸¸æ˜¯æœ€ç»ˆå¾—åˆ†
                score = float(matches[-1])
                break
        
        # å¦‚æœæ²¡å´©ä½†åˆ†å¾ˆä½ï¼Œå¯èƒ½æ˜¯æ¨¡æ‹Ÿå¤±è´¥
        if score == -float('inf'):
            # å°è¯•æ£€æŸ¥ logs æ–‡ä»¶å¤¹
            score = check_latest_log()

        bridge.fitness = score
        print(f"å¾—åˆ† = {score:.2f} (è€—æ—¶ {duration:.1f}s)")
        
    except subprocess.TimeoutExpired:
        print("è¶…æ—¶ (è§†ä¸ºå¤±è´¥)")
        bridge.fitness = -999999
    except Exception as e:
        print(f"é”™è¯¯: {e}")
        bridge.fitness = -999999
        
    return bridge.fitness

def check_latest_log():
    """å¤‡ç”¨æ–¹æ¡ˆï¼šä» logs æ–‡ä»¶å¤¹è¯»å–æœ€æ–°çš„ json ç»“æœ"""
    log_dir = 'logs'
    if not os.path.exists(log_dir): return -float('inf')
    
    files = [os.path.join(log_dir, f) for f in os.listdir(log_dir) if f.endswith('.json')]
    if not files: return -float('inf')
    
    latest_file = max(files, key=os.path.getmtime)
    try:
        with open(latest_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
            return data.get('score', -float('inf'))
    except:
        return -float('inf')

# ================= ç§å­åŠ è½½ =================

def load_seed_from_current_model():
    """ä»å½“å‰çš„ model.py è¯»å–é…ç½®ä½œä¸ºç§å­"""
    print("æ­£åœ¨è§£æå½“å‰ frame/model.py ä½œä¸ºç§å­...")
    try:
        # åŠ¨æ€å¯¼å…¥ model æ¨¡å—
        if os.path.exists(MODEL_FILE):
            sys.path.append(os.path.join(os.getcwd(), 'frame'))
            import model
            import importlib
            importlib.reload(model)
            
            data = model.model()
            sticks = data.get('sticks', [])
            print(f"æˆåŠŸåŠ è½½ç§å­ï¼š{len(sticks)} æ ¹æ†ä»¶")
            return Bridge(sticks)
    except Exception as e:
        print(f"åŠ è½½å¤±è´¥: {e}")
        return None
    return None

# ================= ä¸»æµç¨‹ =================

def main():
    print("="*60)
    print("   SeedCup2025 é—ä¼ ç®—æ³•ä¼˜åŒ–æ¨¡å— - ç‚®ç°è€äººç»„")
    print("="*60)
    
    # 1. ç¯å¢ƒå‡†å¤‡
    if not os.path.exists(BEST_SAVE_DIR):
        os.makedirs(BEST_SAVE_DIR)
        
    # å¤‡ä»½åŸå§‹æ–‡ä»¶
    if os.path.exists(MODEL_FILE):
        shutil.copy(MODEL_FILE, BACKUP_FILE)
        print(f"å·²å¤‡ä»½åŸå§‹æ¨¡å‹è‡³: {BACKUP_FILE}")

    try:
        # 2. åˆå§‹åŒ–ç§ç¾¤
        seed_bridge = load_seed_from_current_model()
        if not seed_bridge:
            print("é”™è¯¯ï¼šæ— æ³•åŠ è½½åˆå§‹æ¨¡å‹ï¼Œè¯·ç¡®ä¿ frame/model.py å­˜åœ¨ä¸”åˆæ³•")
            return

        # ç§ç¾¤ç”± 1ä¸ªç§å­ + (N-1)ä¸ªå˜å¼‚ä½“ ç»„æˆ
        population = [seed_bridge]
        for _ in range(POPULATION_SIZE - 1):
            population.append(mutate(seed_bridge))
            
        best_overall = copy.deepcopy(seed_bridge)
        best_overall.fitness = -float('inf')

        # 3. è¿­ä»£å¾ªç¯
        for gen in range(1, GENERATIONS + 1):
            print(f"\n--- ç¬¬ {gen}/{GENERATIONS} ä»£ ---")
            
            # è¯„ä¼°
            for i, bridge in enumerate(population):
                evaluate(bridge, gen, i)
            
            # æ’åº
            population.sort(key=lambda x: x.fitness, reverse=True)
            current_best = population[0]
            
            print(f"æœ¬ä»£æœ€ä½³: {current_best.fitness:.2f}")
            
            # æ›´æ–°å…¨å±€æœ€ä½³
            if current_best.fitness > best_overall.fitness:
                best_overall = copy.deepcopy(current_best)
                print(f"ğŸ‰ æ–°çš„å…¨å±€æœ€ä½³ï¼å¾—åˆ†: {best_overall.fitness}")
                
                # ä¿å­˜ç»“æœ
                timestamp = datetime.now().strftime("%H%M%S")
                save_path = os.path.join(BEST_SAVE_DIR, f"best_score_{int(best_overall.fitness)}_{timestamp}.py")
                best_overall.save_to_file(save_path)
                print(f"   å·²å½’æ¡£è‡³: {save_path}")
            
            # ä¼˜èƒœåŠ£æ±° (ä¿ç•™å‰50%ï¼Œå‰©ä½™ç”¨æ‚äº¤å˜å¼‚å¡«å……)
            survivors = population[:POPULATION_SIZE//2]
            next_gen = []
            next_gen.extend([copy.deepcopy(b) for b in survivors]) # ç²¾è‹±ä¿ç•™
            
            while len(next_gen) < POPULATION_SIZE:
                p1 = random.choice(survivors)
                p2 = random.choice(survivors)
                c1, c2 = crossover(p1, p2)
                next_gen.append(mutate(c1))
                if len(next_gen) < POPULATION_SIZE:
                    next_gen.append(mutate(c2))
            
            population = next_gen

    except KeyboardInterrupt:
        print("\nç”¨æˆ·ä¸­æ–­...")
    finally:
        # 4. æ¢å¤ç°åœº
        print("\næ­£åœ¨æ¢å¤åŸå§‹ model.py ...")
        if os.path.exists(BACKUP_FILE):
            shutil.copy(BACKUP_FILE, MODEL_FILE)
            os.remove(BACKUP_FILE)
        
        print(f"\nä¼˜åŒ–ç»“æŸã€‚å†å²æœ€ä½³å¾—åˆ†: {best_overall.fitness}")
        print(f"æœ€ä½³æ–¹æ¡ˆæ–‡ä»¶å·²ä¿å­˜åœ¨ {BEST_SAVE_DIR} ç›®å½•ä¸­ã€‚")

if __name__ == "__main__":
    main()
```

------

### å…­ã€ æ€»ç»“

æˆ‘ä»¬é€šè¿‡è‡ªç ”çš„é€†å‘å·¥ç¨‹å·¥å…·ï¼Œæ‰“ç ´äº†æ¯”èµ›ä¸­â€œæ‰‹åŠ¨ç¼–ç ç¹çâ€çš„é™åˆ¶ã€‚æˆ‘ä»¬ä¸ä»…åœ¨å¾®è§‚ä¸Šè®¾è®¡å‡ºäº†ä»…éœ€ **31 æ ¹æ†ä»¶** çš„é«˜æ•ˆè·³è·ƒæ¡¥æ¢ï¼Œæ›´åœ¨å®è§‚ä¸ŠéªŒè¯äº†ä¸€å¥—é«˜æ•ˆçš„**â€œå¯è§†åŒ–è®¾è®¡ -> è‡ªåŠ¨åŒ–è½¬æ¢ -> æ¨¡æ‹ŸéªŒè¯â€**çš„æ•æ·å¼€å‘æµç¨‹ã€‚

è¿™å¥—æ–¹æ¡ˆåœ¨ä¿è¯ 100% é€šè¡Œç‡çš„å‰æä¸‹ï¼Œå°†æˆæœ¬æ§åˆ¶åˆ°äº†æè‡´ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œå·¥å…·çš„åˆ›æ–°ä¸ç»“æ„çš„ç²¾ç®€åŒç­‰é‡è¦ã€‚
